---
title: "WineAnalysis"
author: "PraveenKumar"
date: "August 3, 2016"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Wine Quality Analysis Based on its chemical content

In this rmd file we will do detailed analysis on different chemical composition of 
white wine and its effect on quality

```{r echo=FALSE, warning=FALSE}
library(ggplot2)
library("GGally")
library(memisc)
library(polycor)
```
```{r echo = FALSE, warning=FALSE}
wine <- read.csv('E:/NanoDegreeDataAnalyst/git-repo/Wine-Data-Analysis/wineQualityWhites.csv',header = TRUE)
dim(wine)
```
## Summary information on different variables 
```{r echo=FALSE, warning=FALSE}

summary(wine)
```
```{r echo=FALSE, warning=FALSE}

str(wine)
```

## Univariant Data Analysis 

#### Histogram Analysis
```{r echo=FALSE, warning=FALSE}
ggplot(aes(x = quality),data = wine)+
  geom_histogram(binwidth = .5)+
  scale_x_continuous(limits = c(0, 10), breaks =  seq(0, 10, 1))
  



table(wine$quality) 



```

```{r echo = FALSE, warning=FALSE}
ggplot(aes(x = fixed.acidity),data = wine)+
  geom_histogram()

ggplot(aes(x = fixed.acidity),data = wine)+
  geom_histogram(binwidth = .1)

ggplot(aes(x = volatile.acidity),data = wine)+
  geom_histogram()

ggplot(aes(x = volatile.acidity),data = wine)+
  geom_histogram(binwidth = .01)

ggplot(aes(x = citric.acid),data = wine)+
  geom_histogram()

ggplot(aes(x = citric.acid),data = wine)+
  geom_histogram(binwidth = .01)

ggplot(aes(x = chlorides), data = wine)+
  geom_histogram()
  

ggplot(aes(x = chlorides), data = wine)+
  geom_histogram(binwidth = 0.001)


ggplot(aes(x = pH), data = wine)+
  geom_histogram()

ggplot(aes(x = pH), data = wine)+
  geom_histogram(binwidth = 0.01)

ggplot(aes(x = sulphates), data = wine)+
  geom_histogram()

ggplot(aes(x = sulphates), data = wine)+
  geom_histogram(binwidth = 0.01)

ggplot(aes(x = density), data = wine)+
  geom_histogram()


ggplot(aes(x = density), data = wine)+
  geom_histogram(binwidth = 0.0005)

```

```{r echo = FALSE, warning=FALSE}



ggplot(aes(x = residual.sugar), data = wine)+
  geom_histogram()

ggplot(aes(x = residual.sugar), data = wine)+
  geom_histogram(binwidth = .05)+
  scale_x_log10()

```
The residual sugar has bimodal distribution, may be wine with two sugar values may be of much interest.

```{r echo = FALSE, warning=FALSE}

ggplot(aes(x = free.sulfur.dioxide), data = wine)+
  geom_histogram()

ggplot(aes(x = free.sulfur.dioxide), data = wine)+
  geom_histogram(binwidth = 2)

ggplot(aes(x = total.sulfur.dioxide), data = wine)+
  geom_histogram()

ggplot(aes(x = total.sulfur.dioxide), data = wine)+
  geom_histogram(binwidth = 2)



```
Feature free sulfur dioxise and total sulfur dioxide has outliers. For free sulfur dioxide the value of median 34, 3rd quadrant is 46 but max value is 289. Similarly for total sulfur dioxide median is 134, 3rd quadrant is 167 but max value is 440. 





```{r echo = FALSE, warning=FALSE}
#names(wine)
#summary(wine$alcohol)

ggplot(aes(x = alcohol), data = wine)+
  geom_histogram()

ggplot(aes(x = alcohol), data = wine)+
  geom_histogram(binwidth = 0.005)


```

```{r echo=FALSE, warning=FALSE}

ggplot(aes(x = X),data = wine)+
  geom_histogram( binwidth = .1)+
  scale_x_log10()
summary(wine$X)

```

####What is structure of Data Set ?

The data set has 4898 wines with 13 features (X, fixed.acidity, volatile.acidity,
citric.acid, residual sugar, chlorides, free sulfur dioxide, total sulfur dioxide,
  density, ph, sulphates, alcohol, quality). Follwing are observations made about the data 
  * Most of the wine in this data falls in the quality score of 5,6,7.
  * There is no wine in the data set with with quality less than score of 3 or score of 10.
  * Feature alcohol is uniformly distributed.
  * Feature X is negatively skewed.
  * Other features (fixed.acidity, volatile.acidity,
citric.acid, residual sugar, chlorides, free sulfur dioxide, total sulfur dioxide,
  density, ph, sulphates, alcohol, quality) are normally distributed.
  
####What are the main features of interest?

The quality is the main feature of interest, I will find out how other features will influence quality. I strongly suspect residual sugar has some relation ship with the quality of the wine.Logically it makes sense for alcohol content to have some relationship with wine quality. From this univariant analysis it very difficult to esablish any relationship between quality and other features.

####What are the unusual patterns did u saw in your univariant data analysis? Did you make any adjustment to the data tidy or transform the shpae of the data? If so, why did you do this?

The feature X has unusal shape with histogram with default values, so I applied log transform to the data to obtain right skewed distribution. With most values falling around the value 2500.Residual sugar value is transformed from left skwed to bimodal distribution most of the wine falling around 3 or 9. The bin values is adjusted in all the histogrmas.
  
  
  


## Bivariant Data Analysis 

#### Scatterplot Analysis
```{r echo=FALSE}
#Create bivariant analysis on all the features using ggpairs
set.seed(1836)
wine_sample <- wine[sample.int(nrow(wine),1000),]
head(wine_sample)
ggpairs(wine_sample)

```
```{r echo=FALSE}

ggplot(aes(x = alcohol, y = quality),data = wine)+
  geom_jitter()
ggplot(aes(x = alcohol, y = quality),data = wine)+
  geom_point(alpha = 1/10,position = "jitter")


```

Correlation between alcohol and quality is low at 0.4355, we could not see any relationship in scatterplot as well.  I was expecting some relationship between alcohol and quality of wine.Wine quality less than 6 has most of the alcohol values less than 12. 

Infact correlation between quality and other features are quiet low and I could not see any relationship in scatterplot as well.

names(wine)

```{r echo = FALSE}
ggplot(aes(x = volatile.acidity, y = quality),data = wine)+
  geom_jitter()
ggplot(aes(x = volatile.acidity, y = quality),data = subset(wine,volatile.acidity <= 
                                                                  quantile(wine$volatile.acidity,0.95)))+
  geom_point(alpha = 1/10,position = "jitter")+
   labs(x = "volatile.acidity top 95 percentile")

ggplot(aes(x = chlorides, y = quality),data = wine)+
  geom_jitter()
ggplot(aes(x = chlorides, y = quality),data = wine)+
  geom_point(alpha = 1/10,position = "jitter")

ggplot(aes(x = total.sulfur.dioxide, y = quality),data = wine)+
  geom_jitter()
ggplot(aes(x = total.sulfur.dioxide, y = quality),data = subset(wine,total.sulfur.dioxide <= 
                                                                  quantile(wine$total.sulfur.dioxide,0.95)))+
  geom_point(alpha = 1/10,position = "jitter")+
   labs(x = "total.sulfur.dioxide top 95 percentile")


```

It was quiet surprising to find out none of the individual features had as effect on quality of alcohol. For instance from the scatter plot between quality and volatitle acicdity, quality and chlorides, quality and total sulfur dioxide, I could not make any significat inferences.


```{r echo=FALSE}
#creating Scatterplot for density,alcohol and residual sugar and density.
#Also find the pearson r for the variables.
ggplot(aes(x = alcohol, y = density),data = wine)+
  geom_point()+
  geom_smooth(method = 'lm',color = 'red')

cor.test(wine$alcohol,wine$density)

ggplot(aes(x = residual.sugar, y = density),data = wine)+
  geom_point()+
  xlim(0,quantile(wine$residual.sugar,.95))+
  geom_smooth(method = 'lm',color = 'red')

cor.test(wine$residual.sugar,wine$density)


```

The density and alcohol has some negative correlation, with correlation coefficient of -0.78. The residual sugar and density has positive correlation with correlation value of 0.839

```{r echo=FALSE, warning=FALSE}
#grouping wine into quality of low, medium and high based on quality value

wine$qualityLabel <- ifelse(wine$quality < 5, 'low',ifelse(wine$quality < 7,'medium','high'))

wine$qualityLabel <- ifelse(wine$quality < 6, 'low','high')
table(wine$quality)
table(wine$qualityLabel)

```
It is very difficult to establish any relationship between quality and other features in the dataset. This dataset doesnot have any ordered feature, I created one using quality. The quality is divied into three ordered variable namely low, medium and high. The wine quality score less than 4 are categorized as low, score 5 and 6 are categorized as medium and scores above 6 are categorized as high. 

Based on this categorical quality data we do the boxplot analysis on different variables in this dataset.

#### Boxplot Analysis
```{r echo=FALSE, warning=FALSE}

is.factor(wine$qualityLabel)

wine$qualityLabel <- factor(wine$qualityLabel)


ggplot(aes(x = qualityLabel, y = alcohol),data = wine)+
  geom_boxplot()

ggplot(aes(x = qualityLabel, y = fixed.acidity),data = wine)+
  geom_boxplot()

ggplot(aes(x = qualityLabel, y = volatile.acidity),data = wine)+
  geom_boxplot()

ggplot(aes(x = qualityLabel, y = citric.acid),data = wine)+
  geom_boxplot()

ggplot(aes(x = qualityLabel, y = residual.sugar),data = wine)+
  geom_boxplot()

ggplot(aes(x = qualityLabel, y = chlorides),data = wine)+
  geom_boxplot()

ggplot(aes(x = qualityLabel, y = free.sulfur.dioxide),data = wine)+
  geom_boxplot()

ggplot(aes(x = qualityLabel, y = total.sulfur.dioxide),data = wine)+
  geom_boxplot()

ggplot(aes(x = qualityLabel, y = density),data = wine)+
  geom_boxplot()

ggplot(aes(x = qualityLabel, y = pH),data = wine)+
  geom_boxplot()


```



```{r echo = FALSE}

summary(lm(formula = quality ~ volatile.acidity, data = wine))


wine$qualityFactor <- factor(wine$quality)


ggplot(aes(x = qualityFactor, y = alcohol),data = wine)+
  geom_boxplot()



```

From box plot we can infer that for alcohol quality of 6 and above has increasing median alcohol value.


```{r echo = FALSE}


ggplot(aes(x = qualityFactor, y = volatile.acidity),data = wine)+
  geom_boxplot()



ggplot(aes(x = qualityFactor, y = residual.sugar),data = wine)+
  geom_boxplot()

ggplot(aes(x = qualityFactor, y = chlorides),data = wine)+
  geom_boxplot()

ggplot(aes(x = qualityFactor, y = free.sulfur.dioxide),data = wine)+
  geom_boxplot()

ggplot(aes(x = qualityFactor, y = total.sulfur.dioxide),data = wine)+
  geom_boxplot()



ggplot(aes(x = qualityFactor, y = pH),data = wine)+
  geom_boxplot()


```

Boxplot for pH factor and quality has similar trend as alcohol.Apart from that it is difficult to establish any significant relationship between quality with cholrides or residual sugar or free sulfur dioxide or total sulfur dioxide


```{r echo = FALSE}

hetcor(wine)
names(wine)
ggplot(aes(x = alcohol, y = residual.sugar), data= wine)+
  geom_point(aes(color = qualityFactor))
names(wine)
m1 <- lm(quality ~ alcohol, data = wine)

summary(m1)

m2 <- update(m1, ~ .+ I(log(volatile.acidity)))
summary(m2)

m3 <- update(m2, ~ .+ I(log(residual.sugar)))

summary(m3)

m4 <- update(m3, ~ .+I(total.sulfur.dioxide))

summary(m4)

m5 <- update(m4,~ . +I(log(pH)))


summary(m5)

m6 <- update(m5, ~. +I(log(chlorides)))
summary(m6)

m7 <- update(m6, ~. +sulphates)
summary(m7)

m8 <- update(m7, ~. + I(log(fixed.acidity)))

summary(m8)
mtable(m1,m2,m3,m4,m5,m6,m7,m8)


#density, sulphate
names(wine)
alcohol <- wine[,12]
summary(alcohol)


```


```{r echo = FALSE}
names(wine)
m1 <- lm(quality ~ alcohol, data = wine)

summary(m1)

m2 <- update(m1, ~ .+ volatile.acidity)
summary(m2)

m3 <- update(m2, ~ .+ fixed.acidity)

summary(m3)

m4 <- update(m2, ~ .+ residual.sugar)

summary(m4)

m5 <- update(m4, ~.+ chlorides)

summary(m5)

m5 <- update(m4, ~.+ free.sulfur.dioxide)
summary(m5)

m6 <- update(m5, ~.+ total.sulfur.dioxide)
summary(m6)

m6 <- update(m5, ~.+ pH )
summary(m6)

m7 <- update(m6, ~.+ sulphates)
summary(m7)


```





Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.

---
title: "WineAnalysis"
author: "PraveenKumar"
date: "August 3, 2016"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Wine Quality Analysis Based on its chemical content

In this rmd file we will do detailed analysis on different chemical composition of 
white wine and its effect on quality

```{r echo=FALSE, warning=FALSE}
library(ggplot2)
library("GGally")
library(polycor)
```
```{r echo = FALSE, warning=FALSE}
wine <- read.csv('wineQualityWhites.csv',header = TRUE)
dim(wine)
```
## Summary information on different variables 
```{r echo=FALSE, warning=FALSE}

summary(wine)
```
```{r echo=FALSE, warning=FALSE}

str(wine)
```

## Univariant Data Analysis 

#### Histogram Analysis
```{r echo=FALSE, warning=FALSE}
ggplot(aes(x = quality),data = wine)+
  geom_histogram(binwidth = .5)+
  scale_x_continuous(limits = c(0, 10), breaks =  seq(0, 10, 1))
  



table(wine$quality) 



```

```{r echo = FALSE, warning=FALSE}
ggplot(aes(x = fixed.acidity),data = wine)+
  geom_histogram()

ggplot(aes(x = fixed.acidity),data = wine)+
  geom_histogram(binwidth = .1)

ggplot(aes(x = volatile.acidity),data = wine)+
  geom_histogram()

ggplot(aes(x = volatile.acidity),data = wine)+
  geom_histogram(binwidth = .01)

ggplot(aes(x = citric.acid),data = wine)+
  geom_histogram()

ggplot(aes(x = citric.acid),data = wine)+
  geom_histogram(binwidth = .01)

ggplot(aes(x = chlorides), data = wine)+
  geom_histogram()
  

ggplot(aes(x = chlorides), data = wine)+
  geom_histogram(binwidth = 0.001)


ggplot(aes(x = pH), data = wine)+
  geom_histogram()

ggplot(aes(x = pH), data = wine)+
  geom_histogram(binwidth = 0.01)

ggplot(aes(x = sulphates), data = wine)+
  geom_histogram()

ggplot(aes(x = sulphates), data = wine)+
  geom_histogram(binwidth = 0.01)

ggplot(aes(x = density), data = wine)+
  geom_histogram()


ggplot(aes(x = density), data = wine)+
  geom_histogram(binwidth = 0.0005)

```

```{r echo = FALSE, warning=FALSE}



ggplot(aes(x = residual.sugar), data = wine)+
  geom_histogram()

ggplot(aes(x = residual.sugar), data = wine)+
  geom_histogram(binwidth = .05)+
  scale_x_log10()

```
The residual sugar has bimodal distribution, may be wine with two sugar values may be of much interest.

```{r echo = FALSE, warning=FALSE}

ggplot(aes(x = free.sulfur.dioxide), data = wine)+
  geom_histogram()

ggplot(aes(x = free.sulfur.dioxide), data = wine)+
  geom_histogram(binwidth = 2)

ggplot(aes(x = total.sulfur.dioxide), data = wine)+
  geom_histogram()

ggplot(aes(x = total.sulfur.dioxide), data = wine)+
  geom_histogram(binwidth = 2)



```
Feature free sulfur dioxise and total sulfur dioxide has outliers. For free sulfur dioxide the value of median 34, 3rd quadrant is 46 but max value is 289. Similarly for total sulfur dioxide median is 134, 3rd quadrant is 167 but max value is 440. 





```{r echo = FALSE, warning=FALSE}
#names(wine)
#summary(wine$alcohol)

ggplot(aes(x = alcohol), data = wine)+
  geom_histogram()

ggplot(aes(x = alcohol), data = wine)+
  geom_histogram(binwidth = 0.005)


```

```{r echo=FALSE, warning=FALSE}

ggplot(aes(x = X),data = wine)+
  geom_histogram( binwidth = .1)+
  scale_x_log10()
summary(wine$X)

```

####What is structure of Data Set ?

The data set has 4898 wines with 13 features (X, fixed.acidity, volatile.acidity,
citric.acid, residual sugar, chlorides, free sulfur dioxide, total sulfur dioxide,
  density, ph, sulphates, alcohol, quality). Follwing are observations made about the data 
  * Most of the wine in this data falls in the quality score of 5,6,7.
  * There is no wine in the data set with with quality less than score of 3 or score of 10.
  * Feature alcohol is uniformly distributed.
  * Feature X is negatively skewed.
  * Other features (fixed.acidity, volatile.acidity,
citric.acid, residual sugar, chlorides, free sulfur dioxide, total sulfur dioxide,
  density, ph, sulphates, alcohol, quality) are normally distributed.
  
####What are the main features of interest?

The quality is the main feature of interest, I will find out how other features will influence quality. I stringly suspect residual sugar has some relation ship with the quality of the wine.Logically it makes sense for alcohol content to have some relationship with wine quality. From this univariant analysis it very difficult to esablish any relationship between quality and other features.

####What are the unusual patterns did u saw in your univariant data analysis? Did you make any adjustment to the data tidy or transform the shpae of the data? If so, why did you do this?

The feature X has unusal shape with histogram with default values, so I applied log transform to the data to obtain right skewed distribution. With most values falling around the value 2500.Residual sugar value is transformed from left skwed to bimodal distribution most of the wine falling around 3 or 9. The bin values is adjusted in all the histogrmas.
  
  
  


## Bivariant Data Analysis 

#### Scatterplot Analysis
```{r echo=FALSE}
#Create bivariant analysis on all the features using ggpairs
set.seed(1836)
wine_sample <- wine[sample.int(nrow(wine),1000),]
head(wine_sample)
ggpairs(wine_sample)

```

```{r echo = FALSE}

hetcor(wine)

```

The pearson R between quality and features are quiet low. The alcohol and quality has highest pearson R at 0.4356. Other features that might influence quality are fixed.acidity, volatile.acidity, residual.sugar,chlorides, total.sulfur.dioxide, density and sulphates.


```{r echo=FALSE}
ggplot(aes(x = alcohol, y = quality),data = wine)+
  geom_jitter()

ggplot(aes(x = alcohol, y = quality),data = wine)+
  geom_point(alpha = 1/2, position = position_jitter(h=0))

cor.test(wine$alcohol,wine$quality)

```
From the scatter plot between alcohol and quality we can see alcohol quality at 5,6,7 have range of alcohol content from 7 percent to 13 percent. The lower quality wine of 5 and below have alcohol content predominently in the range of 7 and 11. 





```{r echo = FALSE}
ggplot(aes(x = alcohol, y = density),data = wine)+
  geom_jitter()
ggplot(aes(x = alcohol, y = density),data = wine)+
  geom_point(alpha = 1/2,position = position_jitter(h=0))+
  geom_smooth(method = 'lm',color = 'red')

cor.test(wine$alcohol,wine$density)

```
Density and alcohol seems to have negative correlation with pearson R value of -0.7801. Wine with higher alcohol content have lowe density. 


```{r echo=FALSE}
#creating Scatterplot for density,alcohol and residual sugar and density.
#Also find the pearson r for the variables.


ggplot(aes(x = residual.sugar, y = density),data = wine)+
  geom_point()+
  xlim(0,quantile(wine$residual.sugar,.95))+
  scale_x_log10()+
  geom_smooth(method = 'lm',color = 'red')



  
cor.test(wine$residual.sugar,wine$density)


```

 The residual sugar and density has positive correlation with correlation value of 0.839

```{r echo = FALSE}
ggplot(aes(x = density, y = quality),data = wine)+
  geom_jitter()

ggplot(aes(x = density, y = quality),data =  subset(wine,density <= quantile(density,0.99)))+
  geom_point(alpha = 1/2, position = position_jitter(h=0))

```
As expected the density and quality is opposite of alcohol and quality distribution. For instace lower wine quality have predominatly higher quality. 


```{r echo= FALSE}

ggplot(aes(x = fixed.acidity, y = quality),data = wine)+
  geom_jitter()

ggplot(aes(x = fixed.acidity, y = quality),data = wine)+
  geom_point(alpha = 1/3, position = position_jitter(h=0))


ggplot(aes(x = volatile.acidity, y = quality),data = wine)+
  geom_jitter()

ggplot(aes(x = volatile.acidity, y = quality),data =  subset(wine,volatile.acidity <= quantile(volatile.acidity,0.95)))+
  geom_point(alpha = 1/2, position = position_jitter(h=0))

```

It is difficult to establish any relationship between fixed.acidity and quality. The volatile acidity has lot of outliers, even after removing outliers any relationship between quality and fixed acidity. All the quality values has similar distribution of volatile acidity.


```{r echo = FALSE}



ggplot(aes(x = residual.sugar, y = quality), data = wine)+
  geom_jitter()

ggplot(aes(x = residual.sugar, y = quality),data =  subset(wine,residual.sugar <= quantile(residual.sugar,0.99)))+
  geom_point(alpha = 1/2, position = position_jitter(h=0))

```
The residual sugar has lot of outliers,so only top 99 percentlie is taken into analysis.From the scatter plot we can infer that wine quality which is 4 or below has predominetly lower residual sugar. Wine quality of 5 and above have similar distribution of residual sugar. This is suprise as I was expecting distribution similar to density and quality, but it was similar to alcohol and quality.  

```{r echo = FALSE}


ggplot(aes(x = chlorides, y = quality), data = wine)+
  geom_jitter()

ggplot(aes(x = chlorides, y = quality),data =  subset(wine,chlorides <= quantile(chlorides,0.99)))+
  geom_point(alpha = 1/2, position = position_jitter(h=0))
  

```
The chlorides has some outliers so only top 99 percentile is considered. The middle wine quality has range of chlorides on the other hand lower and higher wine quality has lowe chloride values. This may be because middle wine quality has more sample and hence the variance is quiet high.

```{r ech = FALSE}


ggplot(aes(x = total.sulfur.dioxide, y = quality), data = wine)+
  geom_jitter()

ggplot(aes(x = total.sulfur.dioxide, y = quality),data = wine)+ 
  geom_point(alpha = 1/2, position = position_jitter(h=0))

```



```{r echo = FALSE}


ggplot(aes(x = sulphates, y = quality), data = wine)+
  geom_jitter()

ggplot(aes(x = sulphates, y = quality),data = wine)+ 
  geom_point(alpha = 1/2, position = position_jitter(h=0))


```

Differnt wine quality of wine has similar distribution of sulphates.





```{r echo = FALSE}

wine$qualityfactor <- factor(wine$quality)

table(wine$qualityfactor)

```

To do box plot analysis quality is converted to factor variable.

```{r echo = FALSE}



ggplot(aes(x = qualityfactor, y = alcohol),data = wine)+
  geom_boxplot()

ggplot(aes(x = qualityfactor, y = density),data = wine)+
  geom_boxplot()



```
The wine quality of 6 and above have higher median alcohol value and median alcohol value have increasing trend from alcohol quality 6 and above. As expected we can see exact opposite trend with density.


```{r echo = FALSE}

# residual.sugar,chlorides, #total.sulfur.dioxide, density and sulphates

ggplot(aes(x = qualityfactor, y = fixed.acidity),data = wine)+
  geom_boxplot()

ggplot(aes(x = qualityfactor, y = volatile.acidity),data = subset(wine,volatile.acidity <= quantile(volatile.acidity,0.95)))+
  geom_boxplot()

ggplot(aes(x = qualityfactor, y = residual.sugar),data = subset(wine,residual.sugar <= quantile(residual.sugar,0.99)))+
  geom_boxplot()

ggplot(aes(x = qualityfactor, y = total.sulfur.dioxide),data = subset(wine,total.sulfur.dioxide <= quantile(total.sulfur.dioxide,0.99)))+
  geom_boxplot()

ggplot(aes(x = qualityfactor, y = sulphates),data = subset(wine,sulphates <= quantile(sulphates,0.99)))+
  geom_boxplot()

```

I could not find any definite pattern with boxplot for quality with residual sugar,chlorides,total sulfur dioxide, sulphates.



```{r echo = FALSE}

ggplot(aes(x = qualityfactor, y = chlorides),data = subset(wine,chlorides <= quantile(chlorides,0.95)))+
  geom_boxplot()


```
Lower quality wine has some higher chloride content compared to wine with higher wine quality.

## Bivariant Data Analysis 

#### What are the relationship between features that where observed in bivariant analysis?


We can find relationship between quality and alcohol with correlation coefficient of  0.4356. The higher quality of wine has higher the alcohol content. The higher wine quality of 7, 8 and 9 have higher median alcohol content compared to lower wine quality 

The next feature that influence the wine quality is density, it has correlation value of  -0.3071, the density is physical property which is affected by other chemical feature that is present in the wine, in our case it is affected by alcohol and residual sugar. I strongly suspect density does not affect wine quality in a big way as the density itself affected by presence of other chemicals.

The chloride has negative correlation with wine quality with correlation coefficient of -0.2099. The higher wine quality of 7, 8 and 9 have lower median chloride content compared to lower wine quality.

The other features that seems to have effect on wine quality are fixed acidity, volatile acidity, residual sugar, total sulfur dioxide and sulphates. Further analysis is needed to determine the relationship between these feature and wine quality.


#### Did you find any relationship between other features other than main feature(s) of interest?

The density strongly correlates with residual sugar. The correlation coefficient between density and residual sugar is 0.839.

There is strong negative correlation between alcohol and density, higher the percentage of alcohol lower is the density.

#### What are the features that have strong relationship with feature of interest?

I found strong positve correlation between alcohol and quality. The density had strong negative correlation. The chloride is another feature that had  negative correlation.






```{r echo = FALSE}
names(wine)
ggplot(aes(x = alcohol, y = residual.sugar , size = quality ), data = wine)+
  geom_point(aes(color= quality),shape=21,position = position_jitter(h=.1, w = .1))+
  scale_y_continuous(name = "residual sugar", limits = c(0,20),breaks = seq(0,20,1))+
  scale_x_continuous(name="alcohol", limits=c(8,14),breaks = seq(8,14,0.5))

```




Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
